# Copyright 2018 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause OR GPL-3.0-only
#
# Variables file for deploying NSX-T Cluster
#
{

  #
  # Toggle creation/deletion
  #
  "state": "present",

  #
  # Common NSX Appliance variables
  #
  "nsx_username": "admin",
  "nsx_password": "myPassword1!myPassword1!",
  "validate_certs": False,

  #
  # OVA/OVF Information. Path can be on local file system or a HTTP URL
  #
  "nsx_ova_path": "/home/vmware",
  "nsx_ova": "nsx-unified-appliance-3.0.0.0.0.15567027.ova",

  #
  # Common network details. This assumes all NSX appliance nodes are on the
  # same subnet. If there is a need to deploy NSX appliance nodes which are
  # on different subnets, add node specific details in the blocks below and
  # use them in the playbooks instead.
  #
  "domain": "mylab.local",
  "netmask": "255.255.255.224",
  "gateway": "10.114.200.1",
  "dns_server": "10.114.200.8",
  "ntp_server": "10.114.200.8",

  #
  # First NSX appliance node. Defined separate based on the consumption.
  # Accepts both IP (IPv4) and FQDN for 'mgmt_ip'
  #
  "nsx_node1": {
    "hostname": "mynsx-01.mylab.local",
    "mgmt_ip": "10.114.200.11",
    "datacenter": "Datacenter",
    "cluster": "Management",
    "datastore": "datastore7",
    "portgroup": "VM Network"
  },

  #
  # Additional nodes defined as an array so that its easier to iterate
  # through them in the playbook.
  #
  "additional_nodes": [
    {
      "hostname": "mynsx-02.mylab.local",
      "mgmt_ip": "10.114.200.12",
      "prefix": "27",
      "datacenter": "Datacenter",
      "cluster": "Management",
      "datastore": "datastore4",
      "portgroup": "VM Network"
    },
    {
      "hostname": "mynsx-03.mylab.local",
      "mgmt_ip": "10.114.200.13",
      "prefix": "27",
      "datacenter": "Datacenter",
      "cluster": "Management",
      "datastore": "datastore5",
      "portgroup": "VM Network"
    }
  ],

  #
  # One or more compute managers that have to be registered with NSX
  #
  "compute_managers": [
    {
      "display_name": "vcenter7",
      "mgmt_ip": "10.192.254.154",
      "origin_type": "vCenter",
      "credential_type": "UsernamePasswordLoginCredential",
      "username": "administrator@vsphere.local",
      "password": "Admin!23",
      "set_as_oidc_provider": "true"
    }
  ],

  #
  # NSX License to be applied
  #
  "nsxt_licenses": [
    {
      "license_key": "1111-2222-3333-4444"
    }
  ],

  #
  # Overlay and VLAN Transport Zones needed
  #
  "transport_zones": [
    {
      "display_name": "Overlay-TZ",
      "description": "NSX Configured Overlay Transport Zone",
      "transport_type": "OVERLAY",
      "host_switch_name": "nvds"
    },
    {
      "display_name": "VLAN-TZ",
      "description": "NSX Configured VLAN Transport Zone",
      "transport_type": "VLAN",
      "host_switch_name": "nvds"
    }
  ],

  #
  # TEP IP Pools
  #
  "ip_pools": [
    {
      "display_name": "TEP-IP-Pool",
      "pool_static_subnets": [
        {
          "state": "present",
          "id": "TEP-ip-pool-subnet",
          "allocation_ranges": [
            {
              "start": "172.16.227.20",
              "end": "172.16.227.29"
            }
          ],
          "gateway_ip": "172.16.227.1",
          "cidr": "172.16.227.0/27"
        }
      ],
      "tags": [
        {
          "tag": "pacific",
          "scope": "pacific"
        }
      ]
    }
  ],

  "edge_transport_nodes": [
    {
    
    	"host_switch_spec": {
    		"host_switches": [{
    			"host_switch_type": "NVDS",
    			"host_switch_mode": "STANDARD",
    			"host_switch_profiles": [{
    					"name": "nsx-edge-single-nic-uplink-profile",
    					"type": "UplinkHostSwitchProfile"
    				}
    			],
    			"pnics": [{
    				"device_name": "fp-eth0",
    				"uplink_name": "uplink-1"
    			}],
    			"ip_assignment_spec": {
    				"resource_type": "StaticIpPoolSpec",
    				"ip_pool_name": "TEP-IP-Pool"
    			},
    			"transport_zone_endpoints": [{
    				"transport_zone_id": "1b3a2f36-bfd1-443e-a0f6-4de01abc963e"
    			}]
    		}],
    		"resource_type": "StandardHostSwitchSpec"
    	},
    
    	"node_deployment_info": {
    		"deployment_type": "VIRTUAL_MACHINE",
    		"deployment_config": {
    			"vm_deployment_config": {
    				"vc_name": "vcenter",
    				"vc_username": "administrator@madhu.local",
    				"vc_password": "VMware1!",
    				"compute": "Management",
    				"storage": "datastore7",
    				"management_network": "VM Network",
    				"management_port_subnets": [{
    					"ip_addresses": [
    						"10.114.200.16"
    					],
    					"prefix_length": 27
    				}],
    				"default_gateway_addresses": [
    					"10.114.200.1"
    				],
    				"hostname": "edge-01.madhu.local",
    				"data_networks": [
    					"lab-dvpg"
    				],
    				"enable_ssh": true,
    				"allow_ssh_root_login": true,
    
    				"placement_type": "VsphereDeploymentConfig"
    			},
    			"form_factor": "MEDIUM",
    		  "node_user_settings": {
      			"cli_username": "admin",
      			"root_password": "myPassword1!myPassword1!",
      			"cli_password": "myPassword1!myPassword1!",
      			"audit_username": "audit",
      			"audit_password": "myPassword1!myPassword1!"
      		}
    		},
    		"node_settings": {
    			"hostname": "edge-01.madhu.local",
    			"enable_ssh": true,
    			"allow_ssh_root_login": true
    		},
    		"resource_type": "EdgeNode",
    		"display_name": "edge-01"
    	},
    
    	"resource_type": "TransportNode",
    
    	"display_name": "edge-01"
    }
  ],

  "edge_clusters": [
    {
      "display_name": "Edge-Cluster-01",
      "cluster_profile_bindings": [
        {
          "profile_name": "nsx-default-edge-high-availability-profile"
        }
      ],
      "members": [
        {
          "transport_node_name": "edge-01"
        }
      ]
    }
  ],

  "tier0_gateways": [
    {
      "display_name": "Tier-0",
      "ha_mode": "ACTIVE_STANDBY",
      "tags": [
        {
          "tag": "wcp",
          "scope": "pacific"
        }
      ],
      "locale_services": [
        {
          "state": "present",
          "id": "test-t0ls",
          "route_redistribution_types": ["TIER0_STATIC", "TIER0_NAT"],
          "edge_cluster_info": {
            "edge_cluster_id": "42c68ef2-cdc0-4a25-93e9-a633e001ff7f"
          },
          "BGP": {
            "state": "present",
            "local_as_num": '1211'
          }
        }
      ]
    }
  ],

  "transport_node_profiles": [
    {
      "resource_type": "TransportNodeProfile",
      "display_name": "api-02-vds-tnp",
      "description": "Transport Node profile for WCP",
      "host_switch_spec": {
        "host_switches": [
          {
            "host_switch_id": "50 14 bf dc 06 0a 24 db-c3 68 72 e4 e8 d5 7f fb",
            "host_switch_type": "VDS",
            "host_switch_mode": "STANDARD",
            "host_switch_profiles": [
              {
                "type": "UplinkHostSwitchProfile",
                "name": "nsx-default-uplink-hostswitch-profile"
              }
            ],
            "pnics": [],
            "uplinks": [
              {
                "vds_uplink_name": "Uplink 1",
                "uplink_name": "uplink-1"
              },
              {
                "vds_uplink_name": "Uplink 2",
                "uplink_name": "uplink-2"
              }
            ],
            "is_migrate_pnics": false,
            "ip_assignment_spec": {
              "ip_pool_name": "TEP-IP-Pool",
              "resource_type": "StaticIpPoolSpec"
            },
            "cpu_config": [],
            "transport_zone_endpoints": [
              {
                "transport_zone_name": "nsx-default-overlay-transportzone"
              }
            ],
            "vmk_install_migration": [],
            "pnics_uninstall_migration": [],
            "vmk_uninstall_migration": [],
            "not_ready": false
          }
        ],
        "resource_type": "StandardHostSwitchSpec"
      }
    }
  ],

  "transport_node_collections": [
    {
      "state": "present",
      "display_name": "WCP-TN-Collection",
      "description": "Transport Node Collection",
      "resource_type": "TransportNodeCollection",
      "compute_manager_name": "vcenter7",
      "cluster_name": "wcp-cluster",
      "transport_node_profile_name": "api-01-vds-tnp"
    }
  ],

}
